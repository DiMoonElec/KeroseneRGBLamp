#include <stdint.h>
#include "color.h"



/// Корнвертер из HSV в RGB 
/// Взял отсюда:
/// Статья https://habr.com/post/257131/
/// Ссылка https://drive.google.com/file/d/0B5dbvc_yPqJHQ2FEUXpkR3NocnM/view
/// Оригинальный алгоритм немного переделан, а именно
///  изменен механизм возврата значения компонент R, G, B

const uint8_t dim_curve[256] = {
  0, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3,
  3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6,
  6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
  8, 8, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 11, 11, 11,
  11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15,
  15, 15, 16, 16, 16, 16, 17, 17, 17, 18, 18, 18, 19, 19, 19, 20,
  20, 20, 21, 21, 22, 22, 22, 23, 23, 24, 24, 25, 25, 25, 26, 26,
  27, 27, 28, 28, 29, 29, 30, 30, 31, 32, 32, 33, 33, 34, 35, 35,
  36, 36, 37, 38, 38, 39, 40, 40, 41, 42, 43, 43, 44, 45, 46, 47,
  48, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62,
  63, 64, 65, 66, 68, 69, 70, 71, 73, 74, 75, 76, 78, 79, 81, 82,
  83, 85, 86, 88, 90, 91, 93, 94, 96, 98, 99, 101, 103, 105, 107, 109,
  110, 112, 114, 116, 118, 121, 123, 125, 127, 129, 132, 134, 136, 139, 141, 144,
  146, 149, 151, 154, 157, 159, 162, 165, 168, 171, 174, 177, 180, 183, 186, 190,
  193, 196, 200, 203, 207, 211, 214, 218, 222, 226, 230, 234, 238, 242, 248, 255,
};

/*------------------------------------------------------------------------------
  Корнвертер из HSV в RGB в целочисленной арифмерите
 
  hue        : 0..360
  saturation : 0..255
  value      : 0..255
 ------------------------------------------------------------------------------*/
void HSV_to_RGB(int hue, int sat, int val, uint8_t *rc, uint8_t *gc, uint8_t *bc) 
{
  int    r;
  int    g;
  int    b;
  int    base;
  //uint32_t rgb;

  val = dim_curve[val];
  sat = 255 - dim_curve[255 - sat];


  if ( sat == 0 ) // Acromatic color (gray). Hue doesn't mind.
  {
    (*rc) = val;
    (*gc) = val;
    (*bc) = val;
    //rgb = val | (val<<8) | (val <<16);
  }
  else
  {
    base = ((255 - sat) * val) >> 8;
    switch (hue / 60)
    {
    case 0:
      r = val;
      g = (((val - base) * hue) / 60) + base;
      b = base;
      break;
    case 1:
      r = (((val - base) * (60 - (hue % 60))) / 60) + base;
      g = val;
      b = base;
      break;
    case 2:
      r = base;
      g = val;
      b = (((val - base) * (hue % 60)) / 60) + base;
      break;
    case 3:
      r = base;
      g = (((val - base) * (60 - (hue % 60))) / 60) + base;
      b = val;
      break;
    case 4:
      r = (((val - base) * (hue % 60)) / 60) + base;
      g = base;
      b = val;
      break;
    case 5:
      r = val;
      g = base;
      b = (((val - base) * (60 - (hue % 60))) / 60) + base;
      break;
    }
    (*rc) = r & 0xFF;
    (*gc) = g & 0xFF;
    (*bc) = b & 0xFF;
    //rgb = ((r & 0xFF)<<16) | ((g & 0xFF)<<8) | (b & 0xFF);
  }
  //return rgb;
}

//
// Корнвертер цветовой темпертауты в RGB
// таблицу взял отсюда:
// http://www.vendian.org/mncharity/dir3/blackbody/UnstableURLs/bbr_color.html
//
static const uint8_t tcolor[256][3] ={
{255,51,0},
{255,69,0},
{255,82,0},
{255,93,0},
{255,102,0},
{255,111,0},
{255,118,0},
{255,124,0},
{255,130,0},
{255,135,0},
{255,141,11},
{255,146,29},
{255,152,41},
{255,157,51},
{255,162,60},
{255,166,69},
{255,170,77},
{255,174,84},
{255,178,91},
{255,182,98},
{255,185,105},
{255,189,111},
{255,192,118},
{255,195,124},
{255,198,130},
{255,201,135},
{255,203,141},
{255,206,146},
{255,208,151},
{255,211,156},
{255,213,161},
{255,215,166},
{255,217,171},
{255,219,175},
{255,221,180},
{255,223,184},
{255,225,188},
{255,226,192},
{255,228,196},
{255,229,200},
{255,231,204},
{255,232,208},
{255,234,211},
{255,235,215},
{255,237,218},
{255,238,222},
{255,239,225},
{255,240,228},
{255,241,231},
{255,243,234},
{255,244,237},
{255,245,240},
{255,246,243},
{255,247,245},
{255,248,248},
{255,249,251},
{255,249,253},
{254,250,255},
{252,248,255},
{250,247,255},
{247,245,255},
{245,244,255},
{243,243,255},
{241,241,255},
{239,240,255},
{238,239,255},
{236,238,255},
{234,237,255},
{233,236,255},
{231,234,255},
{229,233,255},
{228,233,255},
{227,232,255},
{225,231,255},
{224,230,255},
{223,229,255},
{221,228,255},
{220,227,255},
{219,226,255},
{218,226,255},
{217,225,255},
{216,224,255},
{215,223,255},
{214,223,255},
{213,222,255},
{212,221,255},
{211,221,255},
{210,220,255},
{209,220,255},
{208,219,255},
{207,218,255},
{207,218,255},
{206,217,255},
{205,217,255},
{204,216,255},
{204,216,255},
{203,215,255},
{202,215,255},
{202,214,255},
{201,214,255},
{200,213,255},
{200,213,255},
{199,212,255},
{198,212,255},
{198,212,255},
{197,211,255},
{197,211,255},
{196,210,255},
{196,210,255},
{195,210,255},
{195,209,255},
{194,209,255},
{194,208,255},
{193,208,255},
{193,208,255},
{192,207,255},
{192,207,255},
{191,207,255},
{191,206,255},
{190,206,255},
{190,206,255},
{190,206,255},
{189,205,255},
{189,205,255},
{188,205,255},
{188,204,255},
{188,204,255},
{187,204,255},
{187,204,255},
{187,203,255},
{186,203,255},
{186,203,255},
{186,203,255},
{185,202,255},
{185,202,255},
{185,202,255},
{184,202,255},
{184,201,255},
{184,201,255},
{184,201,255},
{183,201,255},
{183,201,255},
{183,200,255},
{182,200,255},
{182,200,255},
{182,200,255},
{182,200,255},
{181,199,255},
{181,199,255},
{181,199,255},
{181,199,255},
{180,199,255},
{180,198,255},
{180,198,255},
{180,198,255},
{179,198,255},
{179,198,255},
{179,198,255},
{179,197,255},
{179,197,255},
{178,197,255},
{178,197,255},
{178,197,255},
{178,197,255},
{178,196,255},
{177,196,255},
{177,196,255},
{177,196,255},
{177,196,255},
{177,196,255},
{176,196,255},
{176,195,255},
{176,195,255},
{176,195,255},
{176,195,255},
{176,195,255},
{175,195,255},
{175,195,255},
{175,194,255},
{175,194,255},
{175,194,255},
{175,194,255},
{174,194,255},
{174,194,255},
{174,194,255},
{174,194,255},
{174,194,255},
{174,193,255},
{174,193,255},
{173,193,255},
{173,193,255},
{173,193,255},
{173,193,255},
{173,193,255},
{173,193,255},
{173,193,255},
{173,192,255},
{172,192,255},
{172,192,255},
{172,192,255},
{172,192,255},
{172,192,255},
{172,192,255},
{172,192,255},
{172,192,255},
{171,192,255},
{171,192,255},
{171,191,255},
{171,191,255},
{171,191,255},
{171,191,255},
{171,191,255},
{171,191,255},
{171,191,255},
{170,191,255},
{170,191,255},
{170,191,255},
{170,191,255},
{170,190,255},
{170,190,255},
{170,190,255},
{170,190,255},
{170,190,255},
{170,190,255},
{169,190,255},
{169,190,255},
{169,190,255},
{169,190,255},
{169,190,255},
{169,190,255},
{169,190,255},
{169,190,255},
{169,189,255},
{169,189,255},
{169,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{168,189,255},
{167,188,255},
{167,188,255},
{167,188,255},
{167,188,255},
{167,188,255},
{167,188,255},
{167,188,255},
{167,188,255},
{167,188,255}
};


void TColorToRGB(uint8_t tindex, uint8_t *rc, uint8_t *gc, uint8_t *bc)
{
  (*rc) = tcolor[tindex][0];
  (*gc) = tcolor[tindex][1];
  (*bc) = tcolor[tindex][2];
}
